<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.scentify.group.model.repository.GroupRepository">
    <update id="updateMember">
		    UPDATE `group`
		    <set>
		        member_1_id = CASE 
		            WHEN member_1_id IS NULL THEN #{memberId} 
		            ELSE member_1_id 
		        END,
		        member_1_nickname = CASE 
		            WHEN member_1_id IS NULL THEN #{memberNickname} 
		            ELSE member_1_nickname 
		        END,
		        member_2_id = CASE 
		            WHEN member_1_id IS NOT NULL AND member_2_id IS NULL THEN #{memberId} 
		            ELSE member_2_id 
		        END,
		        member_2_nickname = CASE 
		            WHEN member_1_id IS NOT NULL AND member_2_id IS NULL THEN #{memberNickname} 
		            ELSE member_2_nickname 
		        END,
		        member_3_id = CASE 
		            WHEN member_1_id IS NOT NULL AND member_2_id IS NOT NULL AND member_3_id IS NULL THEN #{memberId} 
		            ELSE member_3_id 
		        END,
		        member_3_nickname = CASE 
		            WHEN member_1_id IS NOT NULL AND member_2_id IS NOT NULL AND member_3_id IS NULL THEN #{memberNickname} 
		            ELSE member_3_nickname 
		        END,
		        member_4_id = CASE 
		            WHEN member_1_id IS NOT NULL AND member_2_id IS NOT NULL AND member_3_id IS NOT NULL AND member_4_id IS NULL THEN #{memberId} 
		            ELSE member_4_id 
		        END,
		        member_4_nickname = CASE 
		            WHEN member_1_id IS NOT NULL AND member_2_id IS NOT NULL AND member_3_id IS NOT NULL AND member_4_id IS NULL THEN #{memberNickname} 
		            ELSE member_4_nickname 
		        END
		    </set>
		    WHERE id = #{id}
		      AND (
		        (member_1_id IS NULL) OR 
		        (member_2_id IS NULL AND member_1_id IS NOT NULL) OR 
		        (member_3_id IS NULL AND member_1_id IS NOT NULL AND member_2_id IS NOT NULL) OR 
		        (member_4_id IS NULL AND member_1_id IS NOT NULL AND member_2_id IS NOT NULL AND member_3_id IS NOT NULL)
		      )
		</update>
</mapper>



<?xml version="1.0" encoding="UTF-8"?>
<mapper namespace="com.example.GroupMapper">
    <update id="updateMember">
        UPDATE `group`
        <set>
            member_1_id = CASE WHEN member_1_id IS NULL THEN #{memberId} ELSE member_1_id END,
            member_1_nickname = CASE WHEN member_1_id IS NULL THEN #{nickname} ELSE member_1_nickname END,
            member_2_id = CASE WHEN member_1_id IS NOT NULL AND member_2_id IS NULL THEN #{memberId} ELSE member_2_id END,
            member_2_nickname = CASE WHEN member_1_id IS NOT NULL AND member_2_id IS NULL THEN #{nickname} ELSE member_2_nickname END,
            member_3_id = CASE WHEN member_1_id IS NOT NULL AND member_2_id IS NOT NULL AND member_3_id IS NULL THEN #{memberId} ELSE member_3_id END,
            member_3_nickname = CASE WHEN member_1_id IS NOT NULL AND member_2_id IS NOT NULL AND member_3_id IS NULL THEN #{nickname} ELSE member_3_nickname END,
            member_4_id = CASE WHEN member_1_id IS NOT NULL AND member_2_id IS NOT NULL AND member_3_id IS NOT NULL AND member_4_id IS NULL THEN #{memberId} ELSE member_4_id END,
            member_4_nickname = CASE WHEN member_1_id IS NOT NULL AND member_2_id IS NOT NULL AND member_3_id IS NOT NULL AND member_4_id IS NULL THEN #{nickname} ELSE member_4_nickname END
        </set>
        WHERE id = #{groupId}
          AND (member_1_id IS NULL OR member_2_id IS NULL OR member_3_id IS NULL OR member_4_id IS NULL)
    </update>
</mapper>
